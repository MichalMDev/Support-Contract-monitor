zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: 7df96b18c230490a9a0a9e2307226338
      name: Templates
  templates:
    - uuid: fbcc2015e7b146d5bcfc7114dd0d118f
      template: 'Support Contract monitor'
      name: 'Support Contract monitor'
      description: |
        Examining support/support for systems.
        See macros
      groups:
        - name: Templates
      items:
        - uuid: d0fecdf9ccf14d938db600d5c3931224
          name: 'Support Days Remaining'
          type: CALCULATED
          key: support.end.date.human
          delay: 1d
          value_type: FLOAT
          trends: '0'
          params: '(last(//support.end.date.unix) - now()) / 86400'
          preprocessing:
            - type: REGEX
              parameters:
                - '^(-?\d+)'
                - \1
            - type: IN_RANGE
              parameters:
                - '-10'
                - ''
          tags:
            - tag: contract
              value: support
          triggers:
            - uuid: 1fbf7ce82036456b9bbcf22dd2eab8ff
              expression: 'last(/Support Contract monitor/support.end.date.human)<30'
              name: 'Support days remaining < 30 days'
              opdata: 'Now: {ITEM.LASTVALUE}'
              priority: HIGH
              manual_close: 'YES'
              tags:
                - tag: contract
                  value: support
            - uuid: e1046de58620487ba9c9a66afeaac346
              expression: 'last(/Support Contract monitor/support.end.date.human)<60'
              name: 'Support days remaining < 60 days'
              opdata: 'Now: {ITEM.LASTVALUE}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                - name: 'Support days remaining < 30 days'
                  expression: 'last(/Support Contract monitor/support.end.date.human)<30'
              tags:
                - tag: contract
                  value: support
            - uuid: 028c11fbf4ed4e7ebbaebb8a12c64344
              expression: 'last(/Support Contract monitor/support.end.date.human)<0'
              name: 'Support expired'
              opdata: 'Now: {ITEM.LASTVALUE}'
              priority: INFO
              manual_close: 'YES'
              dependencies:
                - name: 'Support days remaining < 30 days'
                  expression: 'last(/Support Contract monitor/support.end.date.human)<30'
              tags:
                - tag: contract
                  value: support
        - uuid: 831afdaa222d4b939f97a97edb440468
          name: 'Support End Date (Raw)'
          type: CALCULATED
          key: support.end.date.raw
          delay: 1d
          trends: '0'
          params: '{$SUPPORT_END}'
          description: 'Get value from macro'
          tags:
            - tag: internal_calculation
              value: 'not important'
        - uuid: 426cd19e52a14024bac482abb20941a5
          name: 'Support days remaining unix'
          type: DEPENDENT
          key: support.end.date.unix
          description: 'To unix timestamp'
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  var dateStr = value;
                  var year = parseInt(dateStr.substring(0,4),10);
                  var month = parseInt(dateStr.substring(4,6),10)-1;
                  var day = parseInt(dateStr.substring(6,8),10);
                  return Math.floor(new Date(year, month, day).getTime()/1000);
                  
          master_item:
            key: support.end.date.raw
          tags:
            - tag: internal_calculation
              value: 'not important'
      tags:
        - tag: contract
          value: support
      macros:
        - macro: '{$SUPPORT_END}'
          description: 'YYYYMMDD / Support Contract monitor'
